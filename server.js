require('dotenv').config(); // ะะฐะณััะถะฐะตะผ ัะตะบัะตัั ะธะท .env
const express = require('express'); // ะะผะฟะพััะธััะตะผ ัะบัะฟัะตัั. ะงะขะพ ัะฐะบะพะต ะะบัะฟัะตัั? ะญัะพ ัะฐะบะพะน ััะตะนะผะฒะพัะบ ะดะปั Node.js, ะบะพัะพััะน ะฟะพะผะพะณะฐะตั ะฑััััะพ ะธ ะฟัะพััะพ ัะพะทะดะฐะฒะฐัั ะฒะตะฑ-ัะตัะฒะตัั ะธ ะพะฑัะฐะฑะฐััะฒะฐัั ะทะฐะฟัะพัั.
const fetch = require('node-fetch'); // ะะผะฟะพััะธััะตะผ node-fetch ะดะปั ะฒัะฟะพะปะฝะตะฝะธั HTTP-ะทะฐะฟัะพัะพะฒ
const app = express(); // ะกะพะทะดะฐะตะผ ัะบะทะตะผะฟะปัั ะฟัะธะปะพะถะตะฝะธั Express
const PORT = 3000; // ะะพัั, ะฝะฐ ะบะพัะพัะพะผ ะฑัะดะตั ัะฐะฑะพัะฐัั ัะตัะฒะตั

// ะะพะฒะพัะธะผ ัะตัะฒะตัั ะพัะดะฐะฒะฐัั ัะฒะพะน HTML, CSS ะธ script.js ะธะท ัะตะบััะตะน ะฟะฐะฟะบะธ
app.use(express.static(__dirname)); // __dirname โ ััะพ ะฟััั ะบ ะฟะฐะฟะบะต ั ััะธะผ ัะฐะนะปะพะผ

// ะะฐั ัะตะบัะตัะฝัะน ะผะฐััััั (ะผะพััะธะบ)
app.get('/api/convert/:from/:to', async (req, res) => {
    try {
        const { from, to } = req.params; // ะะตัะตะผ ะฒะฐะปััั, ะบะพัะพััะต ะฟัะธัะปะฐะป ะฑัะฐัะทะตั
        const key = process.env.API_KEY; // ะขะฒะพะน ัะบััััะน ะบะปัั ะธะท .env
        const baseUrl = process.env.BASE_URL; // ะกััะปะบะฐ ะธะท .env

        // ะกะตัะฒะตั ัะฐะผ ะดะตะปะฐะตั ะทะฐะฟัะพั ะบ API (ะฑัะฐัะทะตั ััะพะณะพ ะฝะต ะฒะธะดะธั)
        const response = await fetch(`${baseUrl}${key}/pair/${from}/${to}`); // ะะฐะฟัะพั ะบ ะฒะฝะตัะฝะตะผั API
        const data = await response.json(); // ะะฐััะธะผ ะพัะฒะตั ะฒ JSON

        // ะัะฟัะฐะฒะปัะตะผ ะพัะฒะตั ะพะฑัะฐัะฝะพ ะฒะพ ััะพะฝัะตะฝะด
        res.json(data);
    } catch (error) { // ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ
        console.error("ะัะธะฑะบะฐ ะฝะฐ ัะตัะฒะตัะต:", error); // ะะพะณะธััะตะผ ะพัะธะฑะบั ะฒ ะบะพะฝัะพะปั ัะตัะฒะตัะฐ
        res.status(500).json({ error: "ะกะตัะฒะตั ะฟัะธัะฝัะป ะธ ะฝะต ัะผะพะณ ะฟะพะปััะธัั ะบััั" }); // ะัะฟัะฐะฒะปัะตะผ ะพัะธะฑะบั ะฒะพ ััะพะฝัะตะฝะด
    }
});

// ะะฐะฟััะบะฐะตะผ ััั ัะฐัะผะฐะฝะบั ะบะฐะบ ะฒะตะฑ-ัะตัะฒะตั. ะฏ ะฑะตะดะฝัะน, ะฝะพ ะณะพัะดัะน
app.listen(PORT, () => {
    console.log(`โ ะกะตัะฒะตั ะทะฐะฟััะตะฝ ะฝะฐ http://localhost:${PORT}`);
    console.log(`๐ ะะฐะถะผะธ Ctrl + C, ััะพะฑั ะพััะฐะฝะพะฒะธัั`); 
});